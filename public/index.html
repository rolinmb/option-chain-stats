<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Options Data Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 10px; }
    #file-list { margin-bottom: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #eee; }
    img { max-width: 100%; margin-top: 20px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Options Data Viewer</h1>

  <h2>CSV Viewer</h2>
  <select id="csv-select"></select>
  <div id="csv-table"></div>

  <h2>Image Viewer</h2>
  <select id="img-select"></select>
  <div><img id="preview" src="" alt="Select an image"></div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    async function fetchFileList(path) {
      // Uses directory listing if Flask or http.server exposes it.
      let res = await fetch(path);
      let text = await res.text();

      // Parse file links out of the directory listing (simple regex)
      let matches = [...text.matchAll(/href="([^"]+)"/g)];
      return matches.map(m => m[1]).filter(f => !f.startsWith("?") && !f.startsWith("/"));
    }

    async function loadCSVs() {
      let select = document.getElementById("csv-select");
      let files = await fetchFileList("/data/");
      files.filter(f => f.endsWith(".csv")).forEach(f => {
        let opt = document.createElement("option");
        opt.value = f;
        opt.textContent = f;
        select.appendChild(opt);
      });

      select.addEventListener("change", () => showCSV(select.value));
      if (select.value) showCSV(select.value);
    }

    async function showCSV(filename) {
        let res = await fetch("/data/" + filename);
        let text = await res.text();

        let parsed = Papa.parse(text.trim(), { header: false });

        let rows = parsed.data;
        let table = "<table><thead><tr>" +
        rows[0].map(h => `<th>${h}</th>`).join("") +
        "</tr></thead><tbody>" +
        rows.slice(1).map(r => "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>").join("") +
        "</tbody></table>";

        document.getElementById("csv-table").innerHTML = table;
    }

    async function loadImages() {
      let select = document.getElementById("img-select");
      let files = await fetchFileList("/img/");
      files.filter(f => f.match(/\.(png|jpg|jpeg)$/)).forEach(f => {
        let opt = document.createElement("option");
        opt.value = f;
        opt.textContent = f;
        select.appendChild(opt);
      });

      select.addEventListener("change", () => {
        document.getElementById("preview").src = "/img/" + select.value;
      });

      if (select.value) document.getElementById("preview").src = "/img/" + select.value;
    }

    loadCSVs();
    loadImages();
  </script>
</body>
</html>
